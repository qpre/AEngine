var AE={Assets:{},MVC:{},States:{},Workers:{}},Game={},Graphics={},Graphics2D={Geometry:{}},Graphics3D={Geometry:{}},Audio={},Network={};((function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)h.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},k=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};AE.Network=Network,AE.Singleton=function(){function a(){}return a._instance=null,a.getInstance=function(){return this._instance||(this._instance=new this)},a}(),Function.prototype.property=function(a,b){return Object.defineProperty(this.prototype,a,b)},c=function(a,b){var c;return c=new XMLHttpRequest,c.open("GET",a,!0),c.responseType="blob",c.addEventListener("loadend",function(){return c.status===200?b(c.response):AE.error("could'nt retrieve file: "+a)}),c.send(),c},g=function(a,b){var c;return c=new XMLHttpRequest,c.open("GET",a,!1),c.responseType="blob",c.send(),c.status===200?b(c.response):AE.error("could'nt retrieve file: "+a)},AE.IdFactory=function(a){function b(){this._guids=[]}return j(b,a),b.prototype._guids=null,b.prototype.has=function(a){return this._guids.indexOf(a.toString())>-1?!0:!1},b.prototype.getGUID=function(){var a;return a=this.guid(),this.has(a)?a=this.getGUID():this._guids.push(a),a},b.prototype.s4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)},b.prototype.guid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},b}(AE.Singleton),e=["extended","included"],AE.Object=function(){function a(){}return a.prototype._guid=null,a.property("guid",{get:function(){return this._guid===null&&(this._guid=AE.IdFactory.getInstance().getGUID()),this._guid}}),a.prototype.init=function(){},a.create=function(){var a,b;return a=this,b=new a,arguments.length>0?b.init(arguments):b.init(),b},a.extend=function(a){var b,c,d;for(b in a)c=a[b],k.call(e,b)<0&&(this[b]=c);return(d=a.extended)!=null&&d.apply(this),this},a.include=function(a){var b,c,d;for(b in a)c=a[b],k.call(e,b)<0&&(this.prototype[b]=c);return(d=a.included)!=null&&d.apply(this),this},a}(),Audio.SubSystem=function(a){function b(a){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)}catch(b){AE.error(b),AE.error("AE.Audio : Web Audio API not supported")}this.loadMap(a)}return j(b,a),b.prototype.setVolume=function(a){return this.gainNode.gain.value=a/100},b}(AE.Object),AE.Event=function(){function a(a){this._sender=a,this._subscribers=[]}return a.prototype._subscribers=null,a.prototype._sender=null,a.prototype.subscribe=function(a){return this._subscribers.push(a)},a.prototype.notify=function(a){var b,c,d,e;e=[];for(b=c=0,d=this._subscribers.length-1;c<=d;b=c+=1)e.push(this._subscribers[b](this._sender,a));return e},a}(),AE.Config=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.setConfig=function(a){this._opts=a;if(this._opts)return AE.log("--------------------"),this._opts.name&&AE.log("name: "+this._opts.name),this._opts.version&&AE.log("version: "+this._opts.version),AE.log("--------------------")},b.prototype.get=function(a){return this._opts[a]?this._opts[a]:(AE.error("AE.Config: no such key '"+a+"'"),null)},b}(AE.Singleton),AE.log=function(a){return console.log(a)},AE.debug=function(a){return console.debug(a)},AE.error=function(a){return console.error(a)},a=Object.freeze({ACTIVE:0,PAUSED:1}),AE.States.GamePhase=function(b){function c(a,b,c,d,e){this._name=a,this._in=b,this._out=c,this._run=d,this._beforeFilters=e!=null?e:[],this._statusChangedEvent=new AE.Event(this),this._statusChangedEvent.subscribe(this.onStatusChanged)}return j(c,b),c.prototype._status=a.PAUSED,c.prototype._statusChangedEvent=null,c.prototype.notifyStatusChanged=function(){return this._statusChangedEvent.notify({status:this._status})},c.prototype.onStatusChanged=function(a,b){},c.prototype.setActive=function(){return this._status=a.ACTIVE,this.notifyStatusChanged()},c.prototype.setUnactive=function(){return this._status=a.PAUSED,this.notifyStatusChanged()},c.prototype["in"]=function(){var a,b,c,d;d=this._beforeFilters;for(b=0,c=d.length;b<c;b++)a=d[b],a.apply({},[]);return this._in()},c.prototype.out=function(){return this._out()},c.prototype.run=function(){return this._run()},c}(AE.Object),AE.States.GamePhasesManager=function(a){function b(){this._phases={}}return j(b,a),b.prototype._phases=null,b.prototype._current=null,b.prototype.has=function(a){return this._phases.hasOwnProperty(a)?!0:!1},b.prototype.addPhase=function(a,b,c,d){return this.has(a)?AE.error("Phase "+a+" already exists"):(this._phases[a]=new AE.States.GamePhase(a,b,c,d),AE.Router.getInstance().add(a,function(){return AE.log("applying route"),AE.States.GamePhasesManager.getInstance().setCurrent(a)}.bind(a)))},b.prototype.current=function(){return this._current},b.prototype.setCurrent=function(a){return this.has(a.toString())?(AE.Router.getInstance().navigate(a),this._current=this._phases[a.toString()],this._current.setActive(),this._current["in"](),this._current.run()):AE.error("No such phase: "+a)},b.prototype.transitionTo=function(a){return this._current===null?AE.error("No current phase was set, can't transit from nowhere"):(this._current.out(),this._current.setUnactive(),this.setCurrent(a))},b}(AE.Singleton),AE.Engine=function(a){function b(a){console.log("imma new engine boy!")}return j(b,a),b}(AE.Object),AE.FileSystem=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._filesMap=null,b.prototype._isCreated=null,b.prototype._stack=[],b.prototype.createFileSystem=function(a){this._stack.push(a);if(this._isCreated===null)return this._filesMap={},this.onInitFS()},b.prototype.onInitFS=function(){var a,b,c,d;this._isCreated=!0,d=this._stack;for(b=0,c=d.length;b<c;b++)a=d[b],a.call();return this._stack=[]},b.prototype.writeFile=function(a,b,c){var d,e=this;if(!this._filesMap)return this.createFileSystem(function(){return e.writeFile(a,b,c)});if(this._filesMap[a])return AE.error("A FILE NAMED "+a+" ALREADY EXISTS");d=new Blob([b]),this._filesMap[a]=d;if(c)return c(d)},b.prototype.readFile=function(a,b){var c,d,e=this;return this._filesMap?this._filesMap[a]?(c=this._filesMap[a],d=new FileReader,b&&(d.onloadend=function(){return b(d.result)}),d.readAsText(c)):AE.error("FILE NOT FOUND : #{filePath}"):this.createFileSystem(function(){return e.readFile(a,b)})},b.prototype.readBuffer=function(a,b){var c,d;if(!this._filesMap)return this.createFileSystem(function(){}),this.readFile(a,b);if(this._filesMap[a])return c=this._filesMap[a],d=new FileReader,b?(d.onloadend=function(){return b(d.result)},d.readAsArrayBuffer(c)):AE.error("FILE NOT FOUND : #{filePath}")},b}(AE.Singleton),AE.Assets.URLLoader=function(a){function b(a,b,c){this._fileURL=a,this._onSuccess=b,this._filepath=c,this._filepath||(this._filepath=this.guid),this.guid}return j(b,a),b.prototype.isReady=!1,b.prototype._fileURL=null,b.prototype._file=null,b.prototype.load=function(){return this._fileURL?this.requestURL():AE.error("no file URL were specified")},b.prototype.requestURL=function(){var a=this;return c(this._fileURL,function(b){return AE.FileSystem.getInstance().writeFile(a.guid,b,function(){return a._onSuccess(a._filepath)})})},b}(AE.Object),AE.Assets.Manager=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.assetsOrigin=[],b.prototype.assets={},b.prototype.manifest={},b.prototype.register=function(a){var b,c,d;d=[];for(b in a)c=a[b],this.assetsOrigin.push({name:b,path:c}),d.push(this.assets[b]=null);return d},b.prototype.load=function(a,b){var c,d,e,f,g;this.remaining=this.assetsOrigin.length,f=this.assetsOrigin,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(this.loadSingleAsset(c,a,b));return g},b.prototype.loadSingleAsset=function(a,b,c){var d,e=this;return d=this.createURLLoader(a.path,function(d){console.log(""+a.name+" ready"),e.assets[a.name]=d,e.remaining=e.remaining-1,c();if(e.remaining===0)return b()}),d.load()},b.prototype.get=function(a){return this.assets[a]===null?AE.log(""+a+" not loaded yet"):this.assets[a]===void 0?AE.error(""+a+" not referenced"):this.assets[a]},b.prototype.createURLLoader=function(a,b){var c;return c=new AE.Assets.URLLoader(a,b),c},b}(AE.Singleton),self.document&&(f=document.getElementsByTagName("script"),d=f[f.length-1],b=d.src.replace(/\/script\.js$/,"/")),AE.MVC.Controller=function(){function a(){}return a.prototype.init=function(){},a}(),AE.MVC.Model=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype._propertyChangedEvent=null,b.prototype.init=function(){return this._propertyChangedEvent=new AE.Event(this)},b.prototype.get=function(a){return this[a]},b.prototype.set=function(a,b){return this[a]=b,this.notifyPropertyChanged(a)},b.prototype.notifyPropertyChanged=function(a){return this._propertyChangedEvent.notify({property:a})},b}(AE.Object),AE.MVC.View=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.init=function(){},b}(AE.Object),AE.MessageBox=function(){function a(){}return a.prototype._messages=null,a.prototype.post=function(a,b){return this._messages[a].push(b)},a.prototype.get=function(a){return this._messages[a]},a.prototype.flush=function(a){return this._messages[a]=[]},a.prototype.onMessage=function(a){return self.postMessage("hello from MessageBox !")},a}(),AE.Router=function(a){function b(){var a=this;window.addEventListener("hashchange",function(){return a.listen()},!1),window.addEventListener("load",function(a){return AE.Router.getInstance().check()})}return j(b,a),b.prototype._routes=[],b.prototype._root="/",b.prototype.getFragment=function(){var a,b;return b=window.location.href.match(/#(.*)$/),a=this._clearSlashes(b?b[1]:""),a},b.prototype._clearSlashes=function(a){return a.toString().replace(/\$/,"").replace(/^\//,"")},b.prototype.add=function(a,b,c){return this._routes.push({re:a,handler:b}),c&&(this._root=a),this},b.prototype.remove=function(a){var b,c,d,e;e=this._routes;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.handler===a||b.re.toString()===a.toString())return this._routes.splice(i,1),this}return this},b.prototype.flush=function(){return this._routes=[],this._root="/"},b.prototype.check=function(a){var b,c,d,e,f,g;b=a||this.getFragment(),g=this._routes;for(e=0,f=g.length;e<f;e++){d=g[e],c=b.match(d.re);if(c)return c.shift(),d.handler.apply({},c),this}return AE.log("AE.Router: no such route "+b+", redirecting at index"),this.navigate(this._root)},b.prototype.listen=function(){if(window.location.hash!==this.current)return this.current=window.location.hash,this.check(this.current)},b.prototype.navigate=function(a){return a=a||"",window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+("#"+a),this},b}(AE.Singleton),AE.Workers.Manager=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return j(c,a),c.prototype._workers=[],c.prototype._libBlob=null,c.prototype.createFromScript=function(a){var b,c,d;return b=new Blob([a],{type:"application/javascript"}),c=URL.createObjectURL(b),d=new Worker(c),this._workers.push(d),URL.revokeObjectURL(c),d},c.prototype.createWithMessagingSystem=function(){var a,c,d,e;return d="    self.requestFileSystemSync =       self.webkitRequestFileSystemSync || self.requestFileSystemSync;\n    self.resolveLocalFileSystemURL =       self.webkitResolveLocalFileSystemURL || self.resolveLocalFileSystemURL;\n    self.onmessage = function(e) {\n      var data = e.data;\n      switch (data.cmd) {\n        case 'start':\n          self.postMessage('WORKER STARTED: ' + data.msg);\n          break;\n        case 'stop':\n          self.postMessage('WORKER STOPPED: ' + data.msg +'.            (buttons will no longer work)');\n          self.close();\n          break;\n        case 'loadContext':\n          eval(data.msg);\n        case 'loadFile':\n          try{\n            self.resolveLocalFileSystemURL(data.msg, function(fileEntry) {\n              console.log(fileEntry.name);\n            });\n          } catch (e) {\n            console.error(e);\n          }\n          break;\n        case 'importScript':\n          console.log(data.msg);\n          importScripts(data.msg);\n          self;          break;\n        case 'onmessage':\n          self.onmessage = data.msg;\n          break;\n        default:\n          self.postMessage('Unknown command: ' + data.msg);\n        };\n    };\n    ",e=this.createFromScript(d),e.onmessage=this._onWorkerMessage,c=new AE.MessageBox,a=AE.Assets.Manager.getInstance().createURLLoader(b,function(a){return AE.FileSystem.getInstance().readFile(a,function(a){return e.postMessage({cmd:"loadContext",msg:a})})}),a.load()},c.prototype._onWorkerMessage=function(a){return console.log(a.data)},c.prototype.sendMessageTo=function(a,b){return this._workers[a].postMessage(b)},c}(AE.Singleton),AE.Game=Game,Game.Engine=function(a){function b(a){AE.Config.getInstance().setConfig(a),this.MessageBox=this.MessageBox,this.phasesManager=AE.States.GamePhasesManager.getInstance()}return j(b,a),b.prototype.phasesManager=null,b.prototype._messageBox=null,b.property("MessageBox",{get:function(){return this._messageBox||(this._messageBox=AE.Workers.Manager.getInstance().createWithMessagingSystem()),this._messageBox}}),b}(AE.Engine),function(){var a,b,c;a=0,b=["ms","moz","webkit","o"],c=0;while(c<b.length&&!window.requestAnimationFrame)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"],++c;window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d,e,f;return d=(new Date).getTime(),f=Math.max(0,16-(d-a)),e=window.setTimeout(function(){b(d+f)},f),a=d+f,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Graphics2D.Clickable={intersects:function(a,b){return!1},onClick:function(){return console.log("Baby touch me one more time")}},Graphics2D.Drawable={update:function(){},draw:function(a){}},Graphics2D.Geometry.Circle=function(a){function b(a,b,c,d,e){this.x=a,this.y=b,this.radius=c,this.strokeStyle=d!=null?d:"#00FF00",this.strokeSize=e!=null?e:1,this.squareRadius=this.radius*this.radius}return j(b,a),b.include(Graphics2D.Drawable),b.prototype.draw=function(a){return a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),a.lineWidth=this.strokeSize,a.strokeStyle=this.strokeStyle,a.stroke()},b.prototype.intersects=function(a,b){return(a-this.x)*(a-this.x)+(b-this.y)*(b-this.y)<=this.squareRadius?!0:!1},b.prototype.onClick=function(){return console.log("Baby touch me one more time")},b}(AE.Object),Graphics2D.Geometry.Rectangle=function(a){function b(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.color=e}return j(b,a),b.include(Graphics2D.Drawable),b.prototype.draw=function(a){return a.fillStyle=this.color,a.fillRect(this.x,this.y,this.width,this.height)},b}(AE.Object),AE.Graphics2D=Graphics2D,Graphics2D.Scene=function(a){function b(a,b){this._width=a,this._height=b,this._dom=document.createElement("canvas"),this.resize(this._width,this._height),this.initGestures()}return j(b,a),b.prototype._drawables=[],b.prototype.resize=function(a,b){this._width=a,this._height=b,this._dom.height=this._height,this._dom.width=this._width;if(this._fillRect)return this._drawables[this._fillRect].width=this._width,this._drawables[this._fillRect].height=this._height},b.prototype.fill=function(a){var b;return this._fillRect&&this.remove(this._fillRect),b=new Graphics2D.Geometry.Rectangle(0,0,this._width,this._height,a),this._fillRect=b.guid,this.add(b)},b.prototype.clearScreen=function(){var a;return a=this._dom.getContext("2d"),a.clearRect(0,0,this._width,this._width)},b.prototype.clearAll=function(){var a,b,c,d;c=this._drawables,d=[];for(b in c){if(!h.call(c,b))continue;a=c[b],d.push(delete this._drawables[b])}return d},b.prototype.updateAll=function(){var a,b,c,d;c=this._drawables,d=[];for(b in c){if(!h.call(c,b))continue;a=c[b],a.update?d.push(a.update()):d.push(void 0)}return d},b.prototype.renderAll=function(){var a,b,c,d,e;this.clearScreen(),this.updateAll(),a=this._dom.getContext("2d"),d=this._drawables,e=[];for(c in d){if(!h.call(d,c))continue;b=d[c],e.push(b.draw(a))}return e},b.prototype.add=function(a){return this._drawables[a.guid]=a},b.prototype.remove=function(a){return delete this._drawables[a]},b.prototype.attachTo=function(a){return a.appendChild(this._dom)},b.prototype.start=function(){return this.renderAll(),this._timer=requestAnimationFrame(function(){return this.start()}.bind(this))},b.prototype.stop=function(){return this._timer&&cancelAnimationFrame(this._timer),this._timer=null},b.prototype.initGestures=function(){var a=this;return this._dom.addEventListener("mousedown",function(b){return a.onClick(b)},!1)},b.prototype.onClick=function(a){var b,c,d,e,f,g,i,j,k,l;f=a.pageX,g=a.pageY,e=[],k=this._drawables;for(c in k){if(!h.call(k,c))continue;b=k[c],b.intersects&&b.intersects(f,g)&&e.push(b)}l=[];for(i=0,j=e.length;i<j;i++)d=e[i],l.push(d.onClick());return l},b}(AE.Object),Graphics3D.Drawable=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.update=function(){},b.prototype.draw=function(){},b}(AE.Object),Graphics3D.Geometry.Circle=function(a){function b(a,b){this._radius=a,this._segments=b!=null?b:32,this.geometry=new THREE.CircleGeometry(this._radius,this._segments),this.geometry.vertices.shift(),this.material=new THREE.LineBasicMaterial({color:"cyan"}),this.mesh=new THREE.Line(this.geometry,this.material)}return j(b,a),b.extend(Graphics3D.Drawable),b}(AE.Object),Graphics3D.Geometry.Cube=function(a){function b(){this.geometry=new THREE.BoxGeometry(1,1,1),this.material=new THREE.MeshBasicMaterial({color:65280}),this.mesh=new THREE.Mesh(this.geometry,this.material)}return j(b,a),b.extend(Graphics3D.Drawable),b}(AE.Object),Graphics3D.Geometry.Line=function(a){function b(a,b,c){var d,e,f;this._center=a,this._length=b,this._direction=c,this.geometry=new THREE.Geometry,d=new THREE.Vector3(this._center.x,this._center.y,this._center.z),e=new THREE.Vector3(this._center.x+this._length/2*this._direction.x,this._center.y+this._length/2*this._direction.y,this._center.z+this._length/2*this._direction.z),f=new THREE.Vector3(this._center.x-this._length/2*this._direction.x,this._center.y-this._length/2*this._direction.y,this._center.z-this._length/2*this._direction.z),this.geometry.vertices.push(e),this.geometry.vertices.push(d),this.geometry.vertices.push(f),this.material=new THREE.LineBasicMaterial({color:"cyan"}),this.mesh=new THREE.Line(this.geometry,this.material)}return j(b,a),b.extend(Graphics3D.Drawable),b}(AE.Object),AE.Graphics3D=Graphics3D,Graphics3D.Scene=function(a){function b(a,b){this._width=a,this._height=b,this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(90,this._width/this._height,.1,1e3),this._renderer=new THREE.WebGLRenderer({antialiasing:!0}),this._dom=this._renderer.domElement,this._camera.position.z=5,this._controls=new THREE.OrbitControls(this._camera,this._dom)}return j(b,a),b.prototype._drawables=[],b.prototype.resize=function(a,b){return this._width=a,this._height=b,this._dom.width=this._width,this._dom.height=this._height,this._renderer.setSize(this._width,this._height),this._camera.aspect=this._width/this._height,this._camera.updateProjectionMatrix()},b.prototype.attachTo=function(a){a.appendChild(this._dom),this.resize(a.clientWidth,a.clientHeight);if(AE.Config.getInstance().get("webgl-stats"))return this._stats=new Stats,this._stats.setMode(0),this._stats.domElement.style.position="absolute",this._stats.domElement.style.right="0px",this._stats.domElement.style.top="0px",a.appendChild(this._stats.domElement)},b.prototype.add=function(a){return this._scene.add(a.mesh),this._drawables[a.guid]=a},b.prototype.remove=function(a){return this._scene.remove(this._drawables[a]),delete this._drawables[a]},b.prototype.update=function(){var a,b,c,d;c=this._drawables,d=[];for(b in c){if(!h.call(c,b))continue;a=c[b],a.update?d.push(a.update()):d.push(void 0)}return d},b.prototype.start=function(){return this.render()},b.prototype.stop=function(){return this._timer&&cancelAnimationFrame(this._timer),this._timer=null},b.prototype.render=function(){var a=this;return this._timer=requestAnimationFrame(function(){a._stats&&a._stats.begin(),a.render();if(a._stats)return a._stats.end()}),this._controls.update(),this.update(),this._renderer.render(this._scene,this._camera)},b}(AE.Object),AE.Audio=Audio,Audio.Engine=function(a){function b(){AE.log("AE.Audio: start")}return j(b,a),b.prototype.context=null,b.prototype.effectsSystems={},b.prototype.musicSystems={},b.prototype.createEffectsSubSystem=function(a,b){return this.effectsSystems[a]=new AE.Audio.EffectsSubSystem(b),this.effectsSystems[a]},b.prototype.createMusicSubSystem=function(a,b){return this.musicSystems[a]=new AE.Audio.MusicSubSystem(b),this.musicSystems[a]},b}(AE.Engine),Audio.Effect=function(a){function b(a,b,c){this.name=a,this.system=b,this.callback=c}return j(b,a),b.prototype.name=null,b.prototype.system=null,b.prototype.buffer=null,b.prototype.loaded=!1,b.prototype.prepare=function(a){var b,c=this;return b=AE.Assets.Manager.getInstance().get(this.name),AE.FileSystem.getInstance().readBuffer(b,function(b){return c.system.context.decodeAudioData(b,function(b){c.buffer=b,c.loaded=!0;if(a)return a()})})},b.prototype.fire=function(){var a;return a=this.system.context.createBufferSource(),a.buffer=this.buffer,a.connect(this.system.gainNode),a.start(0)},b}(AE.Object),Audio.EffectsSubSystem=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.sounds={},b.prototype.context=null,b.prototype.length=0,b.prototype.loadMap=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],this.sounds[b]=new AE.Audio.Effect(b,this),e.push(this.length++);return e},b.prototype.fire=function(a){return this.sounds[a]?this.sounds[a].fire():onError()},b.prototype.prepare=function(a){var b,c,d,e,f,g;d=this.length,c=function(){d-=1;if(d===0)return a()}.bind(this,d,a),f=this.sounds,g=[];for(b in f)e=f[b],g.push(e.prepare(c));return g},b}(Audio.SubSystem),Audio.Music=function(a){function b(a,b,c){this.name=a,this.system=b,this.callback=c}return j(b,a),b.prototype.name=null,b.prototype.system=null,b.prototype.buffer=null,b.prototype.loaded=!1,b.prototype.prepare=function(a){var b,c=this;return b=AE.Assets.Manager.getInstance().get(this.name),AE.FileSystem.getInstance().readBuffer(b,function(b){return c.system.context.decodeAudioData(b,function(b){c.buffer=b,c.loaded=!0;if(a)return a()})})},b.prototype.play=function(){var a;return this.loaded===!0?(a=this.system.context.createBufferSource(),a.buffer=this.buffer,a.connect(this.system.gainNode),a.loop=!0,a.start(0)):AE.error("[MUSIC] not loaded yet: "+this.name)},b}(AE.Object),Audio.MusicSubSystem=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.sounds={},b.prototype.context=null,b.prototype.length=0,b.prototype.loadMap=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],this.sounds[b]=new AE.Audio.Music(b,this),e.push(this.length++);return e},b.prototype.play=function(a){return this.sounds[a]?this.sounds[a].play():onError()},b.prototype.prepare=function(a){var b,c,d,e,f,g;d=this.length,c=function(){d-=1;if(d===0)return a()}.bind(this,d,a),f=this.sounds,g=[];for(b in f)e=f[b],g.push(e.prepare(c));return g},b}(Audio.SubSystem),Network.HTTP=function(){function a(){}return a.postJSON=function(a,b){var c;return c=new Promise(function(c,d){var e;return e=new XMLHttpRequest,e.open("POST",a,!0),e.responseType="json",e.onreadystatechange=function(){if(e.readyState===4)return e.status===200?c&&c(e.response):d&&d(e.response)},e.send(b)})},a.getJSON=function(a){var b;return b=new Promise(function(b,c){var d;return d=new XMLHttpRequest,d.open("GET",a,!0),d.responseType="json",d.onreadystatechange=function(){if(d.readyState===4)return d.status===200?b&&b(d.response):c&&c(d.response)},d.send()})},a}()})).call(this)